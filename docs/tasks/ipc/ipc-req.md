# **Стандарт ответов через IPC-сокет**

## **1. Форматы ответов**

### **1.1 Успешный ответ**
#### Текстовый режим (без `j/`):
```
<ключ>: <значение>
<вложенный_ключ>:
    <поле>: <значение>
```
Пример:
```
workspace: main
active_window:
    id: 42
    title: Terminal
```

#### JSON-режим (с `j/`):
```json
{
  "<ключ>": "<значение>",
  "<вложенный_ключ>": {
    "<поле>": "<значение>"
  }
}
```

### **1.2 Ответ с ошибкой**
#### Текстовый режим:
```
error: <описание_ошибки> [<код>]
```
Где `<код>` - числовой код для os.Exit()

Пример:
```
error: Invalid command [1]
```

#### JSON-режим:
```json
{
  "error": "<описание_ошибки>",
  "code": <числовой_код>
}
```
Где `code` - числовой код для os.Exit()

Пример:
```json
{
  "error": "Invalid command",
  "code": 1
}
```

## **2. Коды завершения**

Коды ошибок соответствуют стандартным значениям для os.Exit():
- `0` - Успешное выполнение
- `1` - Общая ошибка
- `2` - Ошибка в аргументах
- `3` - Ошибка доступа
- `4` - Ресурс не найден

## **3. Примеры взаимодействия**

### Успешный запрос (текст):
```
get workspace
→
workspace: main
```

### Ошибка (текст):
```
get invalid
→
error: Not found [4]
```

### Успешный запрос (JSON):
```
j/ get workspace
→
{"workspace":"main"}
```

### Ошибка (JSON):
```
j/ get invalid
→
{"error":"Not found","code":4}
```

## **4. Особенности**

1. При успешном выполнении:
   - В текстовом режиме возвращаются только данные
   - В JSON-режиме возвращается только объект с данными

2. При ошибке:
   - Всегда содержит описание ошибки
   - Всегда содержит числовой код для os.Exit()
   - Формат един для всех типов ошибок

3. Совместимость:
   - Прямой доступ к сокету возвращает данные в чистом виде
   - CLI-утилита использует коды для os.Exit()